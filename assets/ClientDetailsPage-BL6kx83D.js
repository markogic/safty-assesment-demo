import{O as K,J,r as b,j as e,B as j,Q as z,S as R,U as G,l as Q,V}from"./index-EUv0lF0E.js";import{P as E}from"./PageLayout-C1GLBzWx.js";import{I,S as L,T as f}from"./SelectField-q-Eq2bFT.js";const W=c=>{const r=localStorage.getItem("prims_clients");return(r?JSON.parse(r):[]).find(h=>h.id===Number(c))||null},U=[{value:"EU",label:"EU (European Union)"},{value:"UK",label:"UK (United Kingdom)"},{value:"USA",label:"USA (United States)"},{value:"Canada",label:"Canada"}],P=["EU","UK","USA","Canada"],g=[{value:"none",label:"Not Enabled"},{value:"safety",label:"Safety Assessment"},{value:"responsible",label:"Responsible Person"},{value:"all-in",label:"All-In (Safety + Responsible)"}],m=[{id:"bom",name:"BoM",description:"Bill of Materials management. Minimum requirement for every client.",hierarchyLabel:"Hierarchy Level: Base (Required)",required:!0,dependencies:[]},{id:"bom-import",name:"BoM (import)",description:"Enables bulk BoM imports from external files.",requiresLabel:"Requires: BoM module",dependencies:["bom"]},{id:"pif",name:"PIF",description:"Product Information File completeness tool with document downloads.",hierarchyLabel:"Hierarchy Level: 2 (includes BoM)",dependencies:["bom"]},{id:"analyse",name:"Analyse",description:"Safety and compliance assessment tools.",hierarchyLabel:"Hierarchy Level: 3 (includes BoM, PIF)",dependencies:["pif"]},{id:"cpsr-view",name:"CPSR (view)",description:"View and download Cosmetic Product Safety Reports prepared by TRC.",hierarchyLabel:"Hierarchy Level: 4 (includes BoM, PIF, Analyse)",dependencies:["analyse"]},{id:"cpsr-edit",name:"CPSR (edit)",description:"Create and edit Cosmetic Product Safety Reports.",requiresLabel:"Requires: CPSR (view) module",dependencies:["cpsr-view"]},{id:"document-upload",name:"Document Upload",description:"Exchange documents with TRC through the platform.",statusLabel:"Status: In Development",dependencies:[]},{id:"reach",name:"REACH",description:"REACH compliance reporting tool for substance registration.",requiresLabel:"Requires: BoM module (independent add-on)",dependencies:["bom"]},{id:"retailer-client",name:"Retailer Restrictions (client)",description:"Create and manage custom clean beauty restriction lists.",typeLabel:"Type: Independent add-on",dependencies:[]},{id:"retailer-trc",name:"Retailer Restrictions (TRC)",description:"Access clean beauty restriction lists maintained by TRC.",typeLabel:"Type: Independent add-on",dependencies:[]}],X=m.reduce((c,r)=>(c[r.name]=r.id,c),{}),q=m.reduce((c,r)=>(c[r.id]=r.name,c),{});function ie(){const{id:c}=K(),r=J(),[d,h]=b.useState("services"),[a,Y]=b.useState(()=>W(c)),[x,w]=b.useState({name:(a==null?void 0:a.name)||"",code:(a==null?void 0:a.code)||"",type:(a==null?void 0:a.type)||"External access"}),M=s=>{if(!s)return"none";if(typeof s=="string")return g.some(l=>l.value===s)?s:"none";const n=s.safetyAssessment==="yes",i=s.responsiblePerson==="yes";return s.allIn==="yes"||n&&i?"all-in":n?"safety":i?"responsible":"none"},[y,A]=b.useState(()=>{const s={};return P.forEach(n=>{var i;s[n]=M((i=a==null?void 0:a.services)==null?void 0:i[n])}),s}),[p,N]=b.useState(()=>{const s=new Set,n=((a==null?void 0:a.modules)||[]).map(i=>X[i]).filter(Boolean);return m.forEach(i=>{i.required&&s.add(i.id)}),n.forEach(i=>s.add(i)),s}),[C,B]=b.useState(()=>{const s=new Set((a==null?void 0:a.regions)||[]);return s.add("EU"),s}),S=[{value:"External access",label:"External access"},{value:"Internal",label:"Internal"},{value:"Partner",label:"Partner"}];if(!a)return e.jsx(E,{title:"Client Not Found",children:e.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[e.jsx("p",{children:"Client not found. Please go back to the clients list."}),e.jsx(j,{icon:e.jsx(z,{}),variant:"btn-primary",onClick:()=>r("/admin/clients"),children:"Back to Clients"})]})});const _=(s,n)=>{w(i=>({...i,[s]:n}))},k=(s,n)=>{A(i=>({...i,[s]:n}))},F=s=>{const n=m.find(l=>l.id===s);if(!n)return;if(p.has(s)){if(n.required){f.info(`${n.name} is required and cannot be disabled.`);return}const l=new Set,o=v=>{l.add(v),m.forEach(t=>{t.dependencies.includes(v)&&p.has(t.id)&&o(t.id)})};o(s),N(v=>{const t=new Set(v);return l.forEach(H=>t.delete(H)),t});return}const u=n.dependencies.filter(l=>!p.has(l));if(u.length>0){const l=u.map(o=>q[o]||o).join(", ");f.info(`Enable ${l} before turning on ${n.name}.`);return}N(l=>{const o=new Set(l);return o.add(s),o})},T=s=>{s!=="EU"&&B(n=>{const i=new Set(n);return i.has(s)?i.delete(s):i.add(s),i})},$=()=>{const s=m.filter(t=>p.has(t.id)).map(t=>t.name),i=["EU","UK","USA","Canada"].filter(t=>C.has(t)),u={...a,...x,services:y,modules:s,regions:i},l=localStorage.getItem("prims_clients"),v=(l?JSON.parse(l):[]).map(t=>t.id===a.id?u:t);localStorage.setItem("prims_clients",JSON.stringify(v)),f.success("Client details saved successfully!")},O=()=>{r("/admin/clients")},D=P;return e.jsxs(E,{title:a.name,headerActions:e.jsxs(e.Fragment,{children:[e.jsx(j,{icon:e.jsx(Q,{}),variant:"btn-secondary",onClick:O,children:"Cancel"}),e.jsx(j,{icon:e.jsx(V,{}),variant:"btn-primary",onClick:$,children:"Save Changes"})]}),children:[e.jsxs("div",{className:"client-details__info",children:[e.jsxs("div",{className:"client-details__info-header",children:[e.jsx("h3",{children:"Client Information"}),e.jsx("p",{className:"client-details__info-description",children:"Primary client details and identification"})]}),e.jsxs("div",{className:"client-details__info-fields",children:[e.jsxs("div",{className:"client-details__info-field",children:[e.jsx("label",{children:"Name"}),e.jsx(I,{value:x.name,onChange:s=>_("name",s),placeholder:"Client name"})]}),e.jsxs("div",{className:"client-details__info-field",children:[e.jsx("label",{children:"Code"}),e.jsx(I,{value:x.code,onChange:s=>_("code",s),placeholder:"Client code"})]}),e.jsxs("div",{className:"client-details__info-field",children:[e.jsx("label",{children:"Type"}),e.jsx(L,{value:S.find(s=>s.value===x.type),onChange:s=>_("type",(s==null?void 0:s.value)||""),options:S,placeholder:"Select type"})]})]})]}),e.jsxs("div",{className:"client-details__tabs",children:[e.jsxs("div",{className:"client-details__tab-list",children:[e.jsx("button",{className:`client-details__tab ${d==="services"?"is-active":""}`,onClick:()=>h("services"),children:"Services"}),e.jsx("button",{className:`client-details__tab ${d==="modules"?"is-active":""}`,onClick:()=>h("modules"),children:"Modules & Regions"}),e.jsx("button",{className:`client-details__tab ${d==="permissions"?"is-active":""}`,onClick:()=>h("permissions"),children:"Permissions Matrix"}),e.jsx("button",{className:`client-details__tab ${d==="users"?"is-active":""}`,onClick:()=>h("users"),children:"Users"})]}),e.jsxs("div",{className:"client-details__tab-content",children:[d==="services"&&e.jsxs("div",{className:"client-details__services",children:[e.jsxs("div",{className:"client-details__services-header",children:[e.jsx("h4",{children:"Available Services"}),e.jsx("p",{className:"client-details__services-description",children:"Configure services per region for this client"})]}),e.jsx("div",{className:"client-details__services-table",children:e.jsxs("table",{className:"services-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Region"}),e.jsx("th",{children:"Service Offering"})]})}),e.jsx("tbody",{children:D.map(s=>{var n;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"services-table__region",children:((n=U.find(i=>i.value===s))==null?void 0:n.label)||s})}),e.jsx("td",{children:e.jsx(L,{value:g.find(i=>i.value===(y[s]||"none")),onChange:i=>k(s,(i==null?void 0:i.value)||"none"),options:g,className:"services-table__select"})})]},s)})})]})})]}),d==="modules"&&e.jsxs("div",{className:"client-details__modules",children:[e.jsxs("div",{className:"module-hierarchy-card",children:[e.jsx("p",{className:"module-hierarchy-card__label",children:"Module Hierarchy"}),e.jsx("h4",{children:"BoM → PIF → Analyse → CPSR (view)"}),e.jsx("p",{children:"Each module includes all functionalities from lower hierarchy modules. REACH and Retailer Restrictions are independent add-ons."})]}),e.jsxs("div",{className:"module-note",children:[e.jsx(R,{}),e.jsx("span",{children:"BoM module is the minimum requirement for every client. Selecting a higher-level module automatically grants access to all lower-level modules in the hierarchy."})]}),e.jsx("div",{className:"module-card-grid",children:m.map(s=>{const n=p.has(s.id),i=s.dependencies.every(l=>p.has(l)),u=!n&&!i||s.required;return e.jsxs("article",{className:`module-card ${n?"is-selected":""}`,children:[e.jsxs("div",{className:"module-card__header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"module-card__title-row",children:[e.jsx("h5",{children:s.name}),s.required&&e.jsx("span",{className:"module-card__badge module-card__badge--required",children:"Required"})]}),e.jsx("p",{className:"module-card__description",children:s.description})]}),e.jsx("button",{className:`module-card__toggle ${n?"is-on":""}`,onClick:()=>F(s.id),disabled:u,"aria-pressed":n,"aria-label":n?`Disable ${s.name}`:`Enable ${s.name}`,title:s.required?`${s.name} is required`:!n&&!i?`Requires ${s.dependencies.map(l=>q[l]).join(", ")}`:void 0,children:e.jsx("span",{className:"module-card__toggle-track",children:e.jsx("span",{className:"module-card__toggle-thumb"})})})]}),e.jsxs("div",{className:"module-card__meta",children:[s.hierarchyLabel&&e.jsx("span",{className:"module-card__pill",children:s.hierarchyLabel}),s.requiresLabel&&e.jsx("span",{className:"module-card__pill",children:s.requiresLabel}),s.statusLabel&&e.jsx("span",{className:"module-card__pill module-card__pill--status",children:s.statusLabel}),s.typeLabel&&e.jsx("span",{className:"module-card__pill module-card__pill--type",children:s.typeLabel})]})]},s.id)})}),e.jsxs("div",{className:"client-details__regions",children:[e.jsxs("div",{className:"client-details__regions-header",children:[e.jsx("h4",{children:"Available Regions"}),e.jsxs("div",{className:"client-details__regions-note",children:[e.jsx(R,{}),e.jsx("span",{children:"EU is the default region for all clients. Enable additional regions as needed."})]})]}),e.jsx("div",{className:"client-details__region-grid",children:U.map(s=>{const n=C.has(s.value);return e.jsxs("button",{type:"button",className:`region-pill ${n?"is-active":""}`,onClick:()=>T(s.value),disabled:s.value==="EU",children:[e.jsx("span",{className:"region-pill__checkbox",children:n&&e.jsx(G,{})}),e.jsxs("span",{className:"region-pill__label",children:[s.label,s.value==="EU"&&" - Default"]})]},s.value)})})]})]}),d==="permissions"&&e.jsx("div",{className:"client-details__permissions",children:e.jsx("p",{children:"Permissions Matrix will be implemented here."})}),d==="users"&&e.jsx("div",{className:"client-details__users",children:e.jsx("p",{children:"Users management will be implemented here."})})]})]})]})}export{ie as default};
