import{r as _,j as e,A as C,B as f,C as F,S as E,a1 as S,U as k,a2 as A,l as B}from"./index-EUv0lF0E.js";import{P as z}from"./PageLayout-C1GLBzWx.js";import{M as $}from"./ModalOverlay-PraSTF_w.js";import{I as R}from"./InfoSection-BqmwdaxM.js";const M=["EU","UK","USA","CAN"],t={NOT_STARTED:"not_started",UPLOADED:"uploaded",IN_REVIEW:"in_review",APPROVED:"approved",REJECTED:"rejected"},T={[t.NOT_STARTED]:{label:"Not started",className:"req-tile__status--idle"},[t.UPLOADED]:{label:"Uploaded",className:"req-tile__status--uploaded"},[t.IN_REVIEW]:{label:"In review",className:"req-tile__status--review"},[t.APPROVED]:{label:"Approved",className:"req-tile__status--approved"},[t.REJECTED]:{label:"Rejected",className:"req-tile__status--rejected"}};function L({approved:a,total:n}){const u=2*Math.PI*16,d=n>0?a/n:0,h=u-d*u;let c="progress-ring__path--low";d>=.66?c="progress-ring__path--high":d>=.33&&(c="progress-ring__path--mid");const N=Math.round(d*100);return e.jsxs("div",{className:"progress-ring",children:[e.jsxs("svg",{height:18*2,width:18*2,className:"progress-ring__svg",children:[e.jsx("circle",{className:"progress-ring__bg",strokeWidth:4,r:16,cx:18,cy:18}),e.jsx("circle",{className:`progress-ring__path ${c}`,strokeWidth:4,strokeDasharray:`${u} ${u}`,style:{strokeDashoffset:h},r:16,cx:18,cy:18})]}),e.jsxs("div",{className:"progress-ring__labels",children:[e.jsxs("span",{className:"progress-ring__value",children:[a,"/",n]}),e.jsxs("span",{className:"progress-ring__percent",children:[N,"%"]})]})]})}const P=[{id:"prod-1",level:"product",productId:"prod-1",itemName:"Shower Gel - Citrus Fresh",documentType:"PIF Bundle",markets:["EU","UK"],required:!0,rationale:"PIF bundle is required to demonstrate that all mandatory technical documentation is available for the finished product.",acceptedTypes:["PDF"],maxSizeMb:25,example:"Example: Shower Gel PIF v3.pdf",comment:"Imported from PRIMS PIF completeness.",statusByMarket:{EU:t.NOT_STARTED,UK:t.NOT_STARTED}},{id:"formula-1",level:"formula",productId:"prod-1",itemName:"Formula A - Base",documentType:"Method of Manufacture",markets:["EU","UK","USA"],required:!0,rationale:"Method of Manufacture is needed to assess manufacturing controls and reproducibility.",acceptedTypes:["PDF","DOCX"],maxSizeMb:10,example:"Example: MoM_FormulaA_v1.docx",comment:"Often conditional on first-time product or new supplier.",statusByMarket:{EU:t.NOT_STARTED,UK:t.NOT_STARTED,USA:t.NOT_STARTED}},{id:"rm-1",level:"raw_material",productId:"prod-1",itemName:"Cocamidopropyl Betaine",documentType:"SDS",markets:["EU","UK","USA","CAN"],required:!0,rationale:"Safety Data Sheet is required for all raw materials to assess transport and handling risks.",acceptedTypes:["PDF"],maxSizeMb:15,example:"Example: SDS_CocamidopropylBetaine_2025.pdf",comment:"Link to specification in PRIMS Raw Material module.",statusByMarket:{EU:t.APPROVED,UK:t.APPROVED,USA:t.APPROVED,CAN:t.UPLOADED}},{id:"packaging-1",level:"packaging",productId:"prod-1",itemName:"Tube - 200 ml",documentType:"Packaging Specification",markets:["EU","UK"],required:!1,rationale:"Packaging specification is recommended to validate material suitability and dimensions.",acceptedTypes:["PDF"],maxSizeMb:10,example:"Example: Tube_200ml_spec_v2.pdf",comment:"Optional if existing specification already approved in PRIMS.",statusByMarket:{EU:t.NOT_STARTED,UK:t.NOT_STARTED}}];function V({status:a}){if(!a)return null;const n=T[a]||T[t.NOT_STARTED];return e.jsx("span",{className:`req-tile__status ${n.className}`,children:n.label})}function K({status:a,isRequired:n,files:p=[],onFilesAdded:j,onInfoClick:s}){const u=!a||a===t.NOT_STARTED,[d,h]=_.useState(!1),c=_.useRef(null),N=()=>{c.current&&c.current.click()},y=i=>{!j||!i||i.length===0||j(i)};return e.jsxs("div",{role:"button",tabIndex:0,className:`req-tile ${u?"req-tile--empty":""} ${d?"req-tile--drag-over":""} ${n?"tile__required":""}`,onClick:N,onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),N())},onDragEnter:i=>{i.preventDefault(),h(!0)},onDragOver:i=>{i.preventDefault()},onDragLeave:i=>{i.preventDefault(),h(!1)},onDrop:i=>{var v;i.preventDefault(),h(!1);const g=Array.from(((v=i.dataTransfer)==null?void 0:v.files)||[]);y(g)},children:[e.jsxs("div",{className:"req-tile__top",children:[e.jsx(V,{status:a}),n&&e.jsx("span",{className:"req-tile__required",children:"Required"}),s&&e.jsx(f,{icon:e.jsx(E,{}),label:"",variant:"btn-secondary req-tile__info",onClick:i=>{i.stopPropagation(),s()},buttonProps:{type:"button","aria-label":"View requirement details"}})]}),e.jsxs("div",{className:"req-tile__body",children:[u?e.jsxs("span",{className:"req-tile__cta",children:[e.jsx(S,{}),e.jsx("span",{children:"Drop files / Click to upload"})]}):e.jsxs("span",{className:"req-tile__cta req-tile__cta--small",children:[e.jsx(S,{}),e.jsx("span",{children:"Update file"})]}),p&&p.length>0&&e.jsx("div",{className:"req-tile__files-summary",children:p.length===1?p[0].name:`${p.length} files selected`}),e.jsx("input",{ref:c,type:"file",multiple:!0,className:"req-tile__file-input",onChange:i=>{const g=Array.from(i.target.files||[]);y(g),i.target.value=""}})]})]})}function W({requirement:a,onUpdateStatus:n,onFilesAdded:p,onOpenDetails:j}){return e.jsxs("div",{className:"req-row",children:[e.jsxs("div",{className:"req-row__meta",children:[e.jsx("div",{className:"req-row__level",children:a.level}),e.jsx("div",{className:"req-row__title",children:a.itemName}),e.jsx("div",{className:"req-row__doc-type",children:a.documentType})]}),e.jsx("div",{className:"req-row__tiles",children:M.map(s=>{var h;const u=a.markets.includes(s),d=a.statusByMarket[s];return e.jsx("div",{className:"req-row__tile-cell",children:u?e.jsx(K,{status:d,isRequired:a.required,files:(h=a.filesByMarket)==null?void 0:h[s],onFilesAdded:c=>p(a.id,s,c),onInfoClick:()=>j(a,s)}):e.jsx("div",{className:"req-row__tile-cell--na",children:"N/A"})},s)})})]})}function H(){var D;const[a,n]=_.useState(P),[p,j]=_.useState(""),[s,u]=_.useState(null),[d,h]=_.useState(!1),[c,N]=_.useState("all"),y=_.useMemo(()=>{const r=p.toLowerCase();return a.filter(l=>{if(!(!r||l.itemName.toLowerCase().includes(r)||l.documentType.toLowerCase().includes(r)))return!1;if(!d)return!0;const x=Object.values(l.statusByMarket||{}).some(m=>m===t.REJECTED);return!(d&&!x||c!=="all"&&l.productId!==c)})},[a,p,d,c]),i=_.useMemo(()=>a.reduce((r,l)=>{const o=l.markets.length;return r+(l.required?o:0)},0),[a]),g=_.useMemo(()=>a.reduce((r,l)=>{if(!l.required)return r;const o=l.markets.filter(x=>l.statusByMarket[x]===t.APPROVED).length;return r+o},0),[a]),v=(r,l,o)=>{n(x=>x.map(m=>m.id!==r?m:{...m,statusByMarket:{...m.statusByMarket,[l]:o}}))},U=(r,l,o)=>{!o||o.length===0||n(x=>x.map(m=>{var q;if(m.id!==r)return m;const w=((q=m.filesByMarket)==null?void 0:q[l])||[],I=o.map(b=>({name:b.name,size:b.size}));return{...m,filesByMarket:{...m.filesByMarket||{},[l]:[...w,...I]},statusByMarket:{...m.statusByMarket,[l]:t.UPLOADED}}}))},O=()=>{n(P),j(""),u(null),h(!1),N("all")};return e.jsxs(z,{title:"Dushie Document Uploader (Simulation)",stats:[{value:`${g}/${i}`,label:"Required docs approved"},{value:a.length,label:"Requirement rows"}],headerActions:e.jsxs(e.Fragment,{children:[e.jsx(L,{approved:g,total:i}),e.jsx(f,{icon:e.jsx(A,{}),variant:"btn-secondary",onClick:O,children:"Reset demo"})]}),children:[e.jsxs("div",{className:"dushie-portal",children:[e.jsxs("div",{className:"dushie-portal__toolbar",children:[e.jsx("div",{className:"dushie-portal__search",children:e.jsx("div",{className:"search-bar",children:e.jsxs("div",{className:"search-bar__input-wrapper",children:[e.jsx("input",{className:"search-bar__input-native",placeholder:"Search by item or document type...",value:p,onChange:r=>j(r.target.value)}),e.jsxs("button",{type:"button",className:"btn-root btn-primary search-bar__button",children:[e.jsx(C,{}),e.jsx("span",{children:"Find"})]})]})})}),e.jsxs("div",{className:"dushie-portal__filters",children:[e.jsxs("select",{className:"dushie-portal__product-select",value:c,onChange:r=>N(r.target.value),children:[e.jsx("option",{value:"all",children:"All products"}),e.jsx("option",{value:"prod-1",children:"Shower Gel - Citrus Fresh"})]}),e.jsx(f,{icon:e.jsx(F,{}),variant:d?"btn-primary":"btn-secondary",onClick:()=>h(r=>!r),children:d?"Showing Rejected Only":"Show Rejected Only"})]})]}),e.jsxs("div",{className:"dushie-grid",children:[e.jsxs("div",{className:"dushie-grid__header",children:[e.jsx("div",{className:"dushie-grid__meta-col",children:e.jsx("span",{children:"Level / Item"})}),e.jsx("div",{className:"dushie-grid__markets",children:M.map(r=>e.jsx("div",{className:"dushie-grid__market-col",children:r},r))})]}),e.jsxs("div",{className:"dushie-grid__body",children:[y.map(r=>e.jsx(W,{requirement:r,onUpdateStatus:v,onFilesAdded:U,onOpenDetails:(l,o)=>u({requirement:l,market:o})},r.id)),y.length===0&&e.jsx("div",{className:"dushie-grid__empty",children:"No requirements match your search."})]})]})]}),s&&e.jsx($,{isVisible:!0,onClose:()=>u(null),title:"Requirement Details",icon:e.jsx(E,{}),maxWidth:"720px",children:e.jsxs("div",{className:"dushie-details",children:[e.jsxs("div",{className:"dushie-details__header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"dushie-details__breadcrumb",children:[s.requirement.level.toUpperCase()," ·"," ",s.market]}),e.jsx("h3",{children:s.requirement.itemName}),e.jsxs("p",{className:"dushie-details__doc-type",children:["Document: ",s.requirement.documentType,s.requirement.required&&e.jsx("span",{className:"dushie-details__required",children:"REQUIRED"})]})]}),e.jsx("div",{className:"dushie-details__status",children:(()=>{const l=(a.find(x=>x.id===s.requirement.id)||s.requirement).statusByMarket[s.market],o=T[l]||T[t.NOT_STARTED];return e.jsx(e.Fragment,{children:e.jsx("span",{className:`dushie-details__status-badge dushie-details__status-badge--${l}`,children:o.label.toUpperCase()})})})()})]}),e.jsxs("div",{className:"dushie-details__grid",children:[e.jsxs("div",{className:"dushie-details__main",children:[e.jsx(R,{icon:e.jsx(E,{}),title:"Why this document is required",subtitle:s.requirement.rationale||"This document supports regulatory review for this item and market."}),e.jsx(R,{icon:e.jsx(S,{}),title:"Accepted files & limits",subtitle:`Types: ${((D=s.requirement.acceptedTypes)==null?void 0:D.join(", "))||"PDF, DOCX, XLSX, JPG, PNG"} · Max size: ${s.requirement.maxSizeMb||25} MB`}),s.requirement.example&&e.jsx(R,{icon:e.jsx(k,{}),title:"Example document",subtitle:s.requirement.example,variant:"success"}),s.requirement.comment&&e.jsx(R,{icon:e.jsx(E,{}),title:"Additional notes",subtitle:s.requirement.comment,variant:"secondary"})]}),e.jsxs("div",{className:"dushie-details__actions",children:[e.jsx("div",{className:"dushie-details__actions-header",children:"Simulated actions"}),e.jsx(f,{label:"Upload / Replace",icon:e.jsx(S,{}),variant:"btn-primary",onClick:()=>{v(s.requirement.id,s.market,t.UPLOADED)}}),e.jsx(f,{label:"Mark as In Review",icon:e.jsx(A,{}),variant:"btn-secondary",onClick:()=>{v(s.requirement.id,s.market,t.IN_REVIEW)}}),e.jsx(f,{label:"Approve",icon:e.jsx(k,{}),variant:"btn-secondary",onClick:()=>{v(s.requirement.id,s.market,t.APPROVED)}}),e.jsx(f,{label:"Reject",icon:e.jsx(B,{}),variant:"btn-secondary",onClick:()=>{v(s.requirement.id,s.market,t.REJECTED)}})]})]})]})})]})}export{H as default};
